# 牙列标记系统

一个专业的牙列标记与可视化系统，用于口腔医学领域的数字化设计和分析。

## 项目介绍

本系统基于Python开发，集成了先进的3D模型处理和分析算法，能够导入上颌、下颌和咬合关系STL模型，提供牙列标记功能，并提供直观的3D可视化界面进行模型查看和交互。

## 核心功能

### 基础功能
- **多模型导入**：支持导入上颌、下颌和咬合关系STL格式模型
- **自动对齐**：智能对齐上下颌模型，确保解剖学位置正确
- **牙列标记**：标记上颌牙列、下颌牙列、前端、后端位置
- **实时可视化**：高性能3D渲染，支持模型旋转、缩放、平移
- **交互控制**：模型可见性切换、透明度调整
- **详细日志**：完整的处理过程日志，便于调试和分析

### 深度图分析功能
- **实时预览**：标记第一个点时开始生成低分辨率深度图预览
- **多视图比较**：2x2布局显示原始深度图、增强深度图、3D表面图、等高线图
- **对比度调节**：精确的深度范围滑块控制和自动对比度功能
- **色彩映射**：多种色彩方案选择（gray, viridis, plasma, hot, cool, jet）
- **区域统计**：计算深度统计信息（最小值、最大值、平均值、标准差）
- **剖面线分析**：绘制剖面线并显示深度分布曲线
- **测量工具**：距离和角度测量功能
- **高级导出**：支持PNG、SVG、TIFF、PDF、RAW数据格式导出

## 技术栈

- **Python 3.8+**：核心编程语言
- **PyQt5**：图形用户界面框架
- **Open3D**：3D几何处理库
- **PyVista/PyVistaQt**：高性能3D可视化
- **NumPy**：科学计算
- **SciPy**：高级科学算法

## 系统要求

- Windows 10/11 64位系统
- Python 3.8 或更高版本
- 至少8GB内存
- 支持OpenGL的图形卡

## 安装步骤

### 1. 克隆或下载项目

将项目文件下载到本地目录：

```bash
git clone https://github.com/Lipgfi/ToothMarker.git
```

### 2. 安装依赖

使用pip安装所有必要的依赖包：

```bash
cd ToothMarker
pip install -r requirements.txt
```

### 3. 运行程序

安装完成后，直接运行主程序：

```bash
python main.py
```

## 使用指南

### 基本操作流程

1. **导入模型**：
   - 点击"导入上颌模型"按钮，选择上颌STL文件
   - 点击"导入下颌模型"按钮，选择下颌STL文件
   - （可选）点击"导入咬合关系模型"按钮，选择咬合关系STL文件

2. **标记牙列**：
   - 点击"标记上颌牙列"按钮，在3D视图中标记上颌牙列位置
   - 点击"标记下颌牙列"按钮，在3D视图中标记下颌牙列位置
   - 点击"标记前端"按钮，在3D视图中标记前端位置
   - 点击"标记后端"按钮，在3D视图中标记后端位置

3. **查看和调整**：
   - 使用鼠标在3D视图中旋转、缩放、平移模型
   - 调整模型可见性和透明度以获得最佳观察效果

## 3D视图交互

- **旋转**：按住鼠标左键并拖动
- **缩放**：使用鼠标滚轮或按住鼠标右键并拖动
- **平移**：按住鼠标中键并拖动

## 项目结构

```
ToothMarker/
├── main.py                 # 应用程序入口
├── requirements.txt        # 依赖包列表
├── README.md               # 项目文档
├── ui/                     # UI模块
│   ├── __init__.py
│   ├── main_window.py      # 主窗口界面
│   └── model_viewer.py     # 3D模型查看器
├── processing/             # 处理模块
│   ├── __init__.py
│   └── model_loader.py     # 模型加载和预处理
└── utils/                  # 工具函数
    ├── __init__.py
    └── helpers.py          # 辅助功能函数
├── projection_depth_code.py # 深度图投影代码
└── remove_crest_curve.py   # 移除嵴曲线代码
```

## 常见问题解答

### Q: 导入模型失败怎么办？

A: 请检查以下几点：
- 确保文件是STL格式
- 确保文件没有损坏
- 检查文件路径是否包含中文或特殊字符
- 查看程序日志以获取详细错误信息

### Q: 程序运行缓慢怎么办？

A: 可以尝试：
- 减少模型复杂度
- 增加采样比例参数
- 关闭不必要的显示选项
- 确保系统满足最低硬件要求

## 故障排除

### 内存错误

如果处理大型模型时出现内存错误，请：
- 增加系统虚拟内存
- 简化输入模型（减少顶点数量）
- 关闭其他占用内存的程序

### 图形显示问题

如果3D视图显示异常，请：
- 更新显卡驱动
- 确保OpenGL版本兼容
- 尝试降低模型复杂度

## 开发者信息

### 扩展开发

如需扩展功能，可以按照以下步骤：
1. 在相应模块中添加新功能
2. 确保所有函数都有适当的错误处理和日志输出
3. 保持代码风格一致，使用类型提示
4. 添加单元测试以确保功能正常

### 日志系统

程序使用标准输出进行日志记录，包括：
- 操作开始和完成通知
- 处理进度信息
- 错误和警告信息
- 关键参数和结果

## 许可证

本项目仅供研究和教学使用，商业使用请联系开发者。

## 致谢

感谢所有为项目提供帮助和支持的研究人员和开发者。

## 联系方式

如有问题或建议，请联系开发团队。

---

**版本**：1.1.0
**发布日期**：2025年12月
**更新日志**：
- 将应用程序名称从"无牙颌牙合平面生成系统"修改为"牙列标记系统"
- 更新按钮名称：
  - "标记上颌牙槽嵴位置" → "标记上颌牙列"
  - "标记下颌牙槽嵴位置" → "标记下颌牙列"
  - "划分上颌" → "标记前端"
  - "划分下颌" → "标记后端"
- 移除牙颌前面8mm的红色线段标记
- 优化牙列标记功能

